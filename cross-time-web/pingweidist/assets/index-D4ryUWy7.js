import{I as Q,r as f,b as N,o as W,f as F,g as T,h as r,w as n,i as d,p as h,n as b,j as t,X as Z,Y as ee,au as se,t as M,l as ae,v as te,aD as le,E as v,y as re,ae as oe,a6 as ne,s as de,x as ie,aE as ue,aF as pe,aG as me,A as ce,C as fe,D as ve}from"./vendor-Dj-i8j__.js";import{u as ge,g as _e,a as z,_ as we}from"./index-2bWTvhk3.js";const ye=_=>(fe("data-v-25308c3c"),_=_(),ve(),_),he={class:"imglist"},be={class:"list"},Ve={class:"img",style:{display:"grid","grid-template-columns":"repeat(5, 5fr)",gap:"2px"}},Ie=["onClick","src"],Ce={class:"dialog-footer"},Se={class:"personal-center"},xe={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Ee=["src"],Ae=ye(()=>d("p",{style:{position:"absolute","font-size":"40px",color:"rgb(245, 245, 245)",opacity:"0.6"}}," + ",-1)),De={class:"card"},Ue={class:"currentMoney"},Pe={class:"registerTime"},ke={style:{display:"flex"}},Ne=Q({__name:"index",setup(_){const w=ge();let m=f(!1),V=f(""),I=f(""),j=f([]),y=f(-1),C=f({}),i=f(!1);const B=()=>{m.value=!1,e.avatar=C.value.url,V.value=C.value.url};let u=N({}),S=N({}),x=f(""),E=f(),e=N({avatar:"",name:"",sex:"",phone:"",balance:"",address:[],password:"",repassword:"",currentPassword:"",registerTime:"",status:0,message:""});const L=(a,s)=>{y.value=s==y.value?-1:s,y.value==-1?I.value="":I.value=a.url,C.value={...a}},G={name:[{required:!0,validator:(a,s,l)=>{if(s)l();else return l(new Error("用户名不能为空"))},trigger:"blur"}],phone:[{required:!0,validator:(a,s,l)=>{const p=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;s==""?l(new Error("请输入你的手机号")):p.test(s)?l():l(new Error("请正确填写您的手机号码！"))},trigger:"blur"}],password:[{required:!0,validator:(a,s,l)=>{i.value&&s==""?l(new Error("请输入密码")):(e.repassword!==""&&E.value.validateField("repassword"),l())},trigger:"blur"}],repassword:[{required:!0,validator:(a,s,l)=>{i.value&&s===""?l(new Error("请再次输入密码")):s!=e.password?l(new Error("两次输入密码不一致!")):l()},trigger:"blur"}]},O=()=>{u.addr=e.address,u.avatar=e.avatar,u.balance=Number(e.balance),u.name=e.name,e.password==""?u.password=e.currentPassword:u.password=e.password,u.sex=e.sex,u.registerTime=e.registerTime,u.status=e.status.toString(),u.message=e.message,u.phone=e.phone},$=(a,s)=>{let l={};for(let p in a)a[p].toString()!=s[p].toString()&&(l[p]=a[p]);return l},J=a=>a.trim()==""?a.trim():a.split(","),q=a=>a.toString(),R=(a,s)=>{let l=new Date(a),p=new Date(s),U=Math.abs(Number(p)-Number(l)),c=24*60*60*1e3;return Math.floor(U/c).toString()},A=async()=>{let a=await _e();a.status==1&&(e.avatar=a.avatar,e.balance=a.balance,e.name=a.name,e.currentPassword=a.password,e.phone=a.phone,e.registerTime=a.registerTime,e.sex=a.sex,e.avatar=a.avatar,e.status=a.status,e.message=a.message,e.address=J(a.addr),S={...a},x.value=R(e.registerTime.replace(" ","T"),new Date().toLocaleString().replaceAll("/","-")))},X=async()=>{O();let a=$(u,S);if(JSON.stringify(a)=="{}"){v({message:"当前信息没有修改！",type:"info",duration:1e3,showClose:!0});return}await E.value.validate(async s=>{if(!i.value&&s==!0){Array.isArray(a.addr)&&(a.addr=q(a.addr));let l=await z(a);l.status==1?(v({showClose:!0,message:"修改成功",type:"success"}),A(),i.value=!1,a.phone&&localStorage.setItem("token",a.phone),w.getUserInfo()):v({showClose:!0,message:l.message,type:"error"})}else if(!i.value&&s==!1)v({showClose:!0,message:"内容信息不为空，请填写完整",type:"error"});else if(i.value&&s==!1)v({showClose:!0,message:"内容信息不为空，请填写完整",type:"error"});else if(e.currentPassword==e.password)v({message:"当前密码和原密码相同",type:"error"});else{O();let l=$(u,S);Array.isArray(l.addr)&&(l.addr=q(l.addr));let p=await z(l);p.status==1?(v({showClose:!0,message:"修改成功",type:"success"}),A(),e.password="",e.repassword="",i.value=!1,w.getUserInfo()):v({showClose:!0,message:p.message,type:"error"})}})};let D="http://118.190.96.96:90/image/";return W(async()=>{A();let a=await w.getUserAvatar();a.status==0&&a.imgList.map(s=>{j.value.push({id:s.id,url:s.url})})}),(a,s)=>{const l=re,p=oe,U=ne,c=de,g=ie,P=ue,Y=pe,H=me,K=ce;return F(),T("div",null,[r(p,{title:"选择头像",modelValue:t(m),"onUpdate:modelValue":s[1]||(s[1]=o=>h(m)?m.value=o:m=o),width:"30%"},{footer:n(()=>[d("span",Ce,[r(l,{onClick:s[0]||(s[0]=o=>h(m)?m.value=!1:m=!1)},{default:n(()=>[b("取 消")]),_:1}),r(l,{type:"primary",disabled:t(I).length==0,onClick:B},{default:n(()=>[b(" 确定 ")]),_:1},8,["disabled"])])]),default:n(()=>[d("div",he,[d("div",be,[d("div",Ve,[(F(!0),T(Z,null,ee(t(j),(o,k)=>(F(),T("div",{key:k},[d("div",null,[d("img",{class:se({highlighted:k===t(y)}),onClick:Oe=>L(o,k),style:{width:"100%"},src:`${t(D)}`+o.url},null,10,Ie)])]))),128))])])])]),_:1},8,["modelValue"]),d("div",Se,[r(K,{model:t(e),"label-position":"top",rules:G,ref_key:"userInfoForm",ref:E},{default:n(()=>[r(c,{class:"ava",label:"头像",style:{height:"100%"}},{default:n(()=>[d("div",xe,[r(U,{onClick:s[2]||(s[2]=o=>h(m)?m.value=!0:m=!0),class:"avatar-uploader-icon"},{default:n(()=>[d("img",{src:t(V)==""?t(D)+t(w).userInfo.avatar:t(D)+t(V),class:"avatar"},null,8,Ee),Ae]),_:1}),d("div",De,[d("div",Ue," 当前余额"+M(Number(t(e).balance)==0?Number(t(e).balance).toFixed(1):t(e).balance)+"元 ",1),d("div",Pe," 您已跨时空"+M(t(x)?t(x):0)+"天 ",1)])])]),_:1}),r(c,{label:" 用户名",prop:"name"},{default:n(()=>[r(g,{modelValue:t(e).name,"onUpdate:modelValue":s[3]||(s[3]=o=>t(e).name=o)},null,8,["modelValue"])]),_:1}),r(c,{label:"性别",prop:"sex"},{default:n(()=>[r(Y,{modelValue:t(e).sex,"onUpdate:modelValue":s[4]||(s[4]=o=>t(e).sex=o),placeholder:"请选择性别"},{default:n(()=>[r(P,{label:"不愿透露",value:"2"}),r(P,{label:"男",value:"1"}),r(P,{label:"女",value:"0"})]),_:1},8,["modelValue"])]),_:1}),r(c,{label:"电话",prop:"phone"},{default:n(()=>[r(g,{modelValue:t(e).phone,"onUpdate:modelValue":s[5]||(s[5]=o=>t(e).phone=o)},null,8,["modelValue"])]),_:1}),r(c,{label:"当前密码"},{default:n(()=>[d("div",ke,[r(g,{style:{"min-width":"12rem"},inline:"",modelValue:t(e).currentPassword,"onUpdate:modelValue":s[6]||(s[6]=o=>t(e).currentPassword=o),disabled:""},null,8,["modelValue"]),r(l,{style:{"margin-left":"10rem"},size:"default",onClick:s[7]||(s[7]=o=>h(i)?i.value=!t(i):i=!t(i))},{default:n(()=>[b(M(t(i)?"返回":"修改密码"),1)]),_:1})])]),_:1}),ae(d("div",null,[r(c,{label:"密码",prop:"password"},{default:n(()=>[r(g,{"show-password":"",type:"password",modelValue:t(e).password,"onUpdate:modelValue":s[8]||(s[8]=o=>t(e).password=o),autocomplete:"off"},null,8,["modelValue"])]),_:1}),r(c,{label:"确认密码",prop:"repassword"},{default:n(()=>[r(g,{"show-password":"",type:"password",modelValue:t(e).repassword,"onUpdate:modelValue":s[9]||(s[9]=o=>t(e).repassword=o),autocomplete:"off"},null,8,["modelValue"])]),_:1})],512),[[te,t(i)]]),r(c,{label:"地址",prop:"address"},{default:n(()=>[r(H,{size:"large",options:t(le),modelValue:t(e).address,"onUpdate:modelValue":s[10]||(s[10]=o=>t(e).address=o)},null,8,["options","modelValue"])]),_:1}),r(c,null,{default:n(()=>[r(l,{type:"primary",onClick:X},{default:n(()=>[b("保存")]),_:1})]),_:1})]),_:1},8,["model"])])])}}}),ze=we(Ne,[["__scopeId","data-v-25308c3c"]]);export{ze as default};
