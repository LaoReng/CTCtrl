import{d as n,aN as a,E as u}from"./vendor-Dj-i8j__.js";import{r as i}from"./index-2bWTvhk3.js";const c=()=>i.get("equipmentlist"),l=e=>i.post("startEquipmentCtrl",e),d=e=>i.post("controlEquip",e),h=e=>i.post("endEquipmentCtrl",e),f=n("Home",{state:()=>({isLoading:!0,equipInfo:{totalNumber:"",equipments:null},requestParam:{ctrlerPhone:"",bectrlEquipName:"",startCtrlTime:"",key:""},selectedCard:[],saveBusyDevice:!1,isShowShutdownOrReboot:!1,ShutdownOrRebootParam:[],MyType:0,isShowFileSystemDialog:!1,isShowDownLoadList:!0,downLoadList:[],isClickStartOrPause:!1,isClickEnd:!1,rightClickPreviewDeviceName:""}),actions:{async init(){try{const e=await c();return this.equipInfo={...this.equipInfo,...e},this.isLoading=!1,Promise.resolve("获取设备列表成功")}catch{return Promise.reject(new Error("网络错误"))}},async startControl(){try{const e=await l(this.requestParam);//! 输入密钥不正确或者设备不存在
return e.eStatus==2?Promise.reject(e):(e.CtrlTime=(Number(e.CtrlTime)*6e4).toString(),localStorage.setItem("startEquipment",JSON.stringify(e)),Promise.resolve(e))}catch{return Promise.reject(new Error("网络错误"))}},packaingData(){var r;const e=(r=this.equipInfo.equipments)==null?void 0:r.filter(t=>this.selectedCard.includes(t.id));for(let t=0;t<e.length;t++)this.ShutdownOrRebootParam.push({bectrlEquipName:e[t].name,timeout:""})},async endTime(e){try{await h(e),await this.init()}catch{return Promise.reject(new Error("网络错误"))}},open(e){a.confirm(" 当前存在被控设备，确定要执行"+(e==1?"关机":"重启")+"操作吗",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{this.packaingData(),this.isShowShutdownOrReboot=!0}).catch(r=>{this.isShowShutdownOrReboot=!1})},ShutdownOrReboot(e){var r,t,o;if(this.MyType=e,this.selectedCard.length==0){u({type:"warning",message:"请选择设备再试",showClose:!0});return}for(let s=0;s<((r=this.equipInfo.equipments)==null?void 0:r.length);s++){if(this.selectedCard.includes((t=this.equipInfo)==null?void 0:t.equipments[s].id)&&((o=this.equipInfo)==null?void 0:o.equipments[s].eStatus)==2){this.saveBusyDevice=!0;break}this.saveBusyDevice=!1}this.saveBusyDevice?this.open(e):(this.packaingData(),this.isShowShutdownOrReboot=!0)}}});export{f as H,d as s};
