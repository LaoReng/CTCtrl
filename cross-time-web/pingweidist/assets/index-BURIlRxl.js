import{u as g,d as D,I as B,r as m,f as w,g as y,i as a,h as L,j as h,U as S,C as U,D as q,W as V,b as x,o as R,E as N,w as C,X as T,Y as X,H as Y,p as F,Z as P,_ as Q}from"./vendor-Dj-i8j__.js";import{_ as W}from"./logo-uK8Pg4jY.js";import{r as b}from"./requestScreen-lax8Pm0l.js";import{H as j}from"./home-BQ6SLRyk.js";import{_ as H}from"./index-2bWTvhk3.js";const r=n=>b.post("ctrlEvent",n),K=n=>b.post("endEquipmentCtrl",n),G=g(),I=D("VNC",{state:()=>({timer:null,count:0,deadLine:0,baseInfo:{CtrlTime:"",eStatus:null,imageDir:"",name:""},imgParam:{width:0,height:0},miceLocation:{locationX:0,locationY:0},clickDownEventListener:null,clickUpEventListener:null,keywordDownEventListener:null,keywordUpEventListener:null,mouseMoveEventListener:null,mouseScrollEventListener:null,beforeUnloadEventListener:null}),actions:{async commonHandleFinish(){await K({bectrlEquipName:this.baseInfo.name}),clearInterval(this.timer),this.timer=null,localStorage.removeItem("startEquipment"),window.opener=null,window.open("","_self"),window.close(),G.replace({path:"/home"})},async finishControl(){confirm("确定结束控制吗？")&&this.commonHandleFinish()},setBitInByte(n,e){return n|1<<e},getBitFromByte(n,e){return n>>e&1},addClickDownHandler(){const n=document.querySelector(".screen"),e=async o=>{if(o.button==0){let t=0;t=this.setBitInByte(t,4),t=this.setBitInByte(t,2),r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:0})}else if(o.button==1){let t=0;t=this.setBitInByte(t,4),t=this.setBitInByte(t,1),r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:0})}else{let t=0;t=this.setBitInByte(t,4),t=this.setBitInByte(t,0),r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:0})}};n==null||n.addEventListener("mousedown",e),this.clickDownEventListener=e},removeClickDownHandler(){const n=document.querySelector(".screen");this.clickDownEventListener&&(n==null||n.removeEventListener("mousedown",this.clickDownEventListener),this.clickDownEventListener=null)},addClickUpHandler(){const n=document.querySelector(".screen"),e=async o=>{if(o.button==0){let t=0;t=this.setBitInByte(t,5),t=this.setBitInByte(t,2),r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:0})}else if(o.button==1){let t=0;t=this.setBitInByte(t,5),t=this.setBitInByte(t,1),await r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:0})}else{let t=0;t=this.setBitInByte(t,5),t=this.setBitInByte(t,0),await r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:0})}};n==null||n.addEventListener("mouseup",e),this.clickUpEventListener=e},removeClickUpHandler(){const n=document.querySelector(".screen");this.clickUpEventListener&&(n.removeEventListener("mouseup",this.clickUpEventListener),this.clickUpEventListener=null)},addKeyWordDownHandler(){const n=document,e=async o=>{let t=0;t=this.setBitInByte(t,4),await r({bectrlEquipName:this.baseInfo.name,EventType:2,MousePoint:{x:0,y:0},operation:t,Value:o.keyCode})};n.addEventListener("keydown",e),this.keywordDownEventListener=e},addKeyWordUpHandler(){const n=document,e=async o=>{let t=0;t=this.setBitInByte(t,5),await r({bectrlEquipName:this.baseInfo.name,EventType:2,MousePoint:{x:0,y:0},operation:t,Value:o.keyCode})};n.addEventListener("keyup",e),this.keywordUpEventListener=e},removeKeyWordDownHandler(){const n=document;this.keywordDownEventListener&&(n.removeEventListener("keydown",this.keywordDownEventListener),this.keywordDownEventListener=null)},removeKeyWordUpHandler(){const n=document;this.keywordUpEventListener&&(n.removeEventListener("keyup",this.keywordUpEventListener),this.keywordUpEventListener=null)},throttle(n,e){let o=0,t;return function(...i){const d=new Date().getTime(),u=d-o;u>=e?(n.apply(null,i),o=d):(clearTimeout(t),t=setTimeout(()=>{n.apply(null,i),o=new Date().getTime()},e-u))}},addMouseMoveHandler(){const n=document.querySelector(".screen"),e=t=>{this.miceLocation.locationX=Math.round(this.imgParam.width*t.offsetX/n.width),this.miceLocation.locationY=Math.round(this.imgParam.height*t.offsetY/n.height);try{r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:0,Value:0})}catch{}},o=this.throttle(e,0);n==null||n.addEventListener("mousemove",o),this.mouseMoveEventListener=o},removeMouseMoveHandler(){const n=document.querySelector(".screen");this.mouseMoveEventListener&&(n.removeEventListener("mousemove",this.mouseMoveEventListener),this.mouseMoveEventListener=null)},addMouseScrollHander(){const n=document.querySelector(".screen"),e=async o=>{let t=0;t=this.setBitInByte(t,6),o.wheelDelta>0?r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:o.deltaY}).then(i=>{}):r({bectrlEquipName:this.baseInfo.name,EventType:1,MousePoint:{x:this.miceLocation.locationX,y:this.miceLocation.locationY},operation:t,Value:o.deltaY})};n==null||n.addEventListener("wheel",e,!0),this.mouseScrollEventListener=e},removeMouseScrollHandler(){const n=document.querySelector(".screen");this.mouseScrollEventListener&&(n==null||n.removeEventListener("wheel",this.mouseScrollEventListener,!0),this.mouseScrollEventListener=null)}}}),_=n=>(U("data-v-deee80ae"),n=n(),q(),n),J={class:"app-header"},z=_(()=>a("div",{class:"left"},[a("img",{src:W}),a("span",{class:"title"},"跨时空控制台")],-1)),O={class:"center"},Z=_(()=>a("svg",{t:"1716524085812",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3209",width:"32",height:"32"},[a("path",{d:"M511.1 923.8C295 923.8 119.2 748 119.2 531.9c0-108.8 45.8-213.6 125.7-287.6 24-22.2 61.4-20.8 83.6 3.2 22.2 24 20.8 61.4-3.2 83.6-55.8 51.6-87.7 124.8-87.7 200.8 0 150.9 122.7 273.6 273.6 273.6s273.6-122.7 273.6-273.6c0-76.7-30.9-147.8-87-200.1-23.9-22.3-25.2-59.7-2.9-83.6 22.3-23.9 59.7-25.2 83.6-2.9C857.6 319.1 903 423.6 903 531.9c0 216.1-175.8 391.9-391.9 391.9z",fill:"#d81e06","p-id":"3210"}),a("path",{d:"M516.7 663.3c-32.5 0-59.2-26.6-59.2-59.2V160.5c0-32.5 26.6-59.2 59.2-59.2 32.5 0 59.2 26.6 59.2 59.2v443.7c-0.1 32.5-26.7 59.1-59.2 59.1z",fill:"#d81e06","p-id":"3211"})],-1)),$=[Z],ee=B({__name:"VncHeader",setup(n){let e=I(),o=j(),t=g(),i=m(!1);const d=s=>{e.count=Number(s),Math.floor((s-1e3*60*1)/1e3)<0&&(i.value=!0)},u=async s=>{s||(await e.commonHandleFinish(),t.push({path:"/home"}),o.init())},v=()=>{e.finishControl()};return window.onbeforeunload=async()=>{let s=Object.assign({},JSON.parse(localStorage.getItem("startEquipment")));s.CtrlTime=e.count,localStorage.setItem("startEquipment",JSON.stringify(s))},window.onunload=async()=>{v()},(s,l)=>{const f=S;return w(),y("div",J,[z,a("div",O,[L(f,{onChange:d,"value-style":h(i)?{color:"red"}:{color:"white"},onFinish:u,value:h(e).deadLine,format:"HH:mm:ss","time-indices":"",title:"🚩剩余时间"},null,8,["value-style","value"])]),a("div",{class:"right"},[a("div",{class:"btn",onClick:v},$)])])}}}),te=H(ee,[["__scopeId","data-v-deee80ae"]]),ne={key:0,class:"vncContainer"},oe={class:"header"},ie={class:"view"},se={class:"show"},ae=["src"],re={class:"ctrl"},le=["src"],ce={key:1},ue=B({__name:"index",setup(n){let e=I(),o=g(),t=V(),i=m([]),d=x([{name:"鼠标",icon:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAnhJREFUWEftlj9oE1Ecx7+/0wYFhQ5VLteAGRzEDgqCQgVbZwcng/YuBR0cRAfB3YqgU0sHBxWKSP5pUxBFcNChglVBBwVFxKJCm0vSDIpIlaR5X0kGCWeSd1xCs/im497v9/1+7vveuztBj4f02B//AXwlYCa5G8R2VPC+cEpK3Vw2LUD0FvvLITwDMARiUYDJnCPXuwWhBTDTHDGIeY/hE0VMFRx51CmIFsBK8iCknkCzMRMq4+zXk/I7KIgWIJLhAaXwso3BdwGmcrZcDgKhBQinuE+A11pxwVsIzrgn5Lm2tqFACzB4h3tYxRvfosQD15Gjfuu1AGaaQwbxzq9gQ90515Zruj4tgJXmLhAfdEIt5l1DYWQ5Lout+rUAkQR3KgOfAgLU2wSI5WzJNtPQApgZRg2FL50AUDCfH5PDgQAGk4xQsNQJABQuuXGZCASwbZZmXwX5AAAfIbgPVT8VC4H3gJXmAAi/H6ASiKwisoW4eF/fTRm0eyB6j/3lVXzzmwCJ83lHpv3WawEGZrg1tAk//AqCKKwZ2LsyJkU/PVqAyCw3qwpWm4nRwGlRuOmdIzGZd+RCVwBwg33WFpQ9YktVYLRoy2crxacADnnNFLG/4MgrHYQ2AZBipaH+CgkeV9fgFMdlpXbPSvE4gMw/RsRd15HaXNuhB6iZpLkAYpiCuQ0bMb4ck1+NqlaSDyE44nUS4ljOkbl2BL4AagJmgqOtjlabn5YXri3DXQHQRRlO8bYA494615a2D+k7AR3AjgTDFQOupy7r2hJblwTqGzLBCRi4WLsW4mo5hCulmPxcNwBdSs3mu7YEQczrSQVt7FZfzwH+AJHrziEaOC7AAAAAAElFTkSuQmCC",import.meta.url).href,isChecked:!1},{name:"键盘",icon:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAT5JREFUWEftVkFKw0AUfT/anSV0IXoGPUC7GaoU7AE6pXgKdx7CRa/RLlL3BaGS2bRHEcQ66NZJiVCQNOMMfygpNLNK+PPfe/n/ZeYT9rCk0lkOm4iYXPDODS6Asngt4LgrINPPHoheALwnIj53eSjIhMPF96U5/Xki4A7ARYFsmoj4fq8CBqmeEmFUIHkDMG80Th4nnbP8+d8VVAGp9AeAljFR97nbTF1kZfFQAd4Hjk1cLaCuwG8FhunXFciMM6DPcTIjZ5UBDzMRr2igdJuAJQMkOIWy6Jqk0jl5GzC3iWi9BqN6AEi1vgGiBQHzXEDwv+zBubNly7sjoCjI9m4j3U5BvjiHJ4BTTk6OtQUcME6O0wN/p1rffrr6X4Zp9UBlAjjl5OQcvgd8+ln25a68Yrw+B6q/jCq/jqseSDY82ERu7ibs8gAAAABJRU5ErkJggg==",import.meta.url).href,isChecked:!1}]),u=m(""),v=m(!0),s=m(!1),l=m(!1);const f=()=>{i.value.includes("鼠标")==!0&&i.value.includes("键盘")==!0?(l.value==!1&&(e.addKeyWordDownHandler(),e.addKeyWordUpHandler(),l.value=!0),s.value==!1&&(e.addClickDownHandler(),e.addClickUpHandler(),e.addMouseMoveHandler(),e.addMouseScrollHander(),s.value=!0)):i.value.includes("鼠标")==!0&&i.value.includes("键盘")==!1?(l.value==!0&&(e.removeKeyWordDownHandler(),e.removeKeyWordUpHandler(),l.value=!1),s.value==!1&&(e.addClickDownHandler(),e.addClickUpHandler(),e.addMouseMoveHandler(),e.addMouseScrollHander(),s.value=!0)):i.value.includes("键盘")==!0&&i.value.includes("鼠标")==!1?(s.value==!0&&(e.removeClickDownHandler(),e.removeMouseMoveHandler(),e.removeClickUpHandler(),e.removeMouseScrollHandler(),s.value=!1),l.value==!1&&(e.addKeyWordDownHandler(),e.addKeyWordUpHandler(),l.value=!0)):(l.value==!0&&(e.removeKeyWordDownHandler(),e.removeKeyWordUpHandler(),l.value=!1),s.value==!0&&(e.removeClickDownHandler(),e.removeClickUpHandler(),e.removeMouseScrollHandler(),e.removeMouseMoveHandler(),s.value=!1))};return R(()=>{document.addEventListener("contextmenu",function(A){A.preventDefault()});let k=t.query;const c=JSON.parse(localStorage.getItem("startEquipment"));if(!c){N({type:"error",message:"参数错误",showClose:!0,duration:1e3}),o.replace("/home");return}e.deadLine=Date.now()+parseInt(c.CtrlTime);let E={width:c.width,height:c.height};e.imgParam={...E},e.baseInfo={...c,...k},e.timer=setInterval(()=>{u.value=`http://www.ctctrl.nat300.top/imageApi/image/${e.baseInfo.imageDir}.jpeg?timer=${Date.now()}`},150),v.value=!0}),(k,c)=>{const E=P,A=Q;return h(v)?(w(),y("div",ne,[a("div",oe,[L(te)]),a("div",ie,[a("div",se,[a("img",{class:"screen",src:h(u)},null,8,ae)]),a("div",re,[L(A,{onChange:f,fill:"#585eaa",modelValue:h(i),"onUpdate:modelValue":c[0]||(c[0]=p=>F(i)?i.value=p:i=p)},{default:C(()=>[(w(!0),y(T,null,X(h(d),(p,M)=>(w(),Y(E,{value:p.name,key:M},{default:C(()=>[a("img",{src:p.icon},null,8,le)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])])])):(w(),y("div",ce))}}}),we=H(ue,[["__scopeId","data-v-dfe0a3f2"]]);export{we as default};
